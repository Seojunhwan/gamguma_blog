---
title: 
description: 
author: Junhwan Seo
createAt: 2022-04-27 22:53
hashTags: [BE, DB]
isPublished: false
thumbnail: /2022/04/js_execution_context/images/thumbnail.png
---



## mongoDB 스키마 디자인 설계

현재 하고있는 프로젝트에서 자꾸 SQL 처럼 테이블을 잘게잘게 쪼개야하나 라는 생각이 자꾸 들었습니다.
그렇기에 mongoDB 의  [블로그](https://www.mongodb.com/developer/article/mongodb-schema-design-best-practices/) 를 읽고 이 게시글을 작성합니다!

mongoDB 는 다른 관계형 DB 처럼 스키마 설계를 하지 말라고 합니다.

우선은 관계형 DB와 mongoDB 를 비교하며 설명합니다.

## 관계형 데이터베이스

관계형 DB의 스키마를 디자인 할 땐 우선 필요한 데이터를 정하고, 정규화 과정을 통해 데이터들이 중복되지 않도록 여러 테이블로 나눕니다.

예를 들어 하나의 유저 테이블이 있고,

## mongoDB

스키마 설계를 할 때 중요한 것은 개발하고자 하는 서비스에 알맞게 스키마를 디자인 하는 것

우선 스키마 디자인을 할 때 고려할 수 있는 디자인 방식은 `Embedding` 과 `Referencing` 입니다.

### Embedding

**장점**

- 하나의 쿼리문으로 필요한 모든 데이터를 가져올 수 있다.
- `$lookup` 과 같은 Join 동작을 수행하지 않고 데이터를 가져올 수 있다.

**한계점**

- `document`가 커지면 오버헤드 또한 함께 커진다 (문서의 크기를 제한하여 쿼리 성능을 향상하자)

- `document`는 16mb 의 크기제한을 갖고 있어서 Embedding 방식을 계속 사용한다면 언젠간 한계에 도달한다

### Referencing

참조형 같은 경우 각각의 `document`들이 가지고 있는 특별한 id 인 `object id` 와 `$lookup` 을 이용해 데이터를 참조할 수 있습니다.
이는 관계형 데이터베이스에서의 JOIN 과 흡사하게 동작합니다.
이러한 참조형은 데이터를 효율적이고 관리하기 쉽게 나누면서도 **데이터간의 관계를 유지**할 수 있습니다.

**장점**

- `document`를 쪼개어 더욱 작은 단위의 `document`를 가질 수 있으며 이를 통해 16mb 크기 제한을 피할 수 있습니다.
- 필요하지 않은 정보에 대한 접근을 줄일 수 있습니다.
- `document` 를 참조하여 데이터를 가져오기에 `Embedding` 방식보다 데이터의 중복을 줄일 수 있습니다.

**한계점**

- 하나의 `document` 안에 다수의 데이터가 참조형이라면 다수의 쿼리, `$lookup`, `populate` 가 필요합니다. (현재 프로젝트하며 걱정인 부분)

## 설계

### One-to-One

```json
{
    "_id": "ObjectId('mdkalsfmk2')",
    "nickname": "junseo",
    "campus": "42seoul",
}
```

위와 같은 `User document` 가 있으면 `nickname` 과 `campus` 와 같이 하나만 존재하는 값이 1:1 관계며, `key-value` 로 모델링 할 수 있습니다.

### One-to-Few

```json
{
    "_id": "ObjectId('mdkalsfmk2')",
    "nickname": "junseo",
    "campus": "42seoul",
    "projects": [
        { "name": "42WE", "isDone": false},
        { "name": "Decrypto",  "isDone": true}
    ]
}
```

위와 같은 `document` 에서 `projects` 는 배열로 2개의 값을 가지고 있습니다. 이처럼 `User document` 에서 `projects` 는 1:n 관계입니다.

### One-to-Many

## 결론

`document` 를 나눠야 할 이유가 명확하지 않다면 `embedding` 하여 사용하자.
가능한 경우 $lookup 이나 populate 를 피하지만 이를 통해 더 나은 스키마 디자인 설계가 가능하다면 걱정하지 말고 써라.
몽고디비 디자인은 관계형 디비 디자인처럼 하지 말자
 document에 필요한 데이터를 다 넣어서, 처리를 하는 것이 좀더 선
 transaction 과같은 고비용 처리는 그다지 많이 사용되지는 않습
